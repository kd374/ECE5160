<!DOCTYPE html>
<html lang="en">
    <head>
		<title>ECE5160 Portfolio</title>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
		<link rel="stylesheet" href="assets/css/main.css" />
		<noscript><link rel="stylesheet" href="assets/css/noscript.css" /></noscript>
	</head>
<body class="is-preload">
		<!-- Wrapper -->
		<!--	<div id="wrapper" class="fade-in"> -->

				<!-- Intro -->
                <div id="intro">
                    <h1>LAB 3</h1>
                    <p>Tine of Flight (ToF)</p>
                    <ul class="actions">
                        <li><a href="#header" class="button icon solid solo fa-arrow-down scrolly">Continue</a></li>
                    </ul>
                </div>

            <!-- Header -->
            <header id="header">
                    <a href="index.html" class="logo">ECE 5160 | Fast Robots: Lab 3</a>
                </header>

                

            <!-- Nav -->
                <nav id="nav">
                    <ul class="links">
                        <li class="active"><a href="index.html">LAB 3</a></li>
                    </ul>
                    <ul class="icons">
                        <li><a href="https://www.linkedin.com/in/katarina-duric/" class="icon brands fa-linkedin"><span class="label">Linkedin</span></a></li> 
                        <li><a href="https://github.com/kd374" class="icon brands fa-github"><span class="label">GitHub</span></a></li>
                </nav>

				<!-- Main -->
                <div id="main">

                    <!-- Featured Post -->
                    <head>
                        <meta charset="UTF-8">
                        <meta name="viewport" content="width=device-width, initial-scale=1.0">
                        <title>LAB 3</title>
                    
                        <!-- Inline CSS for this page only -->
                        <style>
                            /* Reduce spacing between paragraphs, sections, and images */
                            p, h3, h2, pre, img {
                                margin-bottom: 10px; /* Less space between rows */
                            }
                    
                            /* Reduce spacing between sections */
                            .content-section {
                                margin-bottom: 15px; /* Less space between sections */
                                padding-bottom: 5px;
                                
                                border-bottom: 1px solid #ddd;  /* Adds a light gray line */
                                padding-bottom: 15px;
                                 margin-bottom: 20px;

                            }
                    
                            /* Make subtitles (h3) left-aligned */
                            h3 {
                                text-align: left;
                                font-size: 20px; /* Adjust subtitle font size */
                                margin-left: 5px;
                            }
                    
                            /* Center images */
                            .center-content img {
                                display: block;
                                margin: 0 auto;
                                width: 500px; /* Adjust width */
                                height: auto;
                            }
                    
                            /* Center code blocks */
                            pre {
                                background-color: #f4f4f4;
                                padding: 10px;
                                border-radius: 5px;
                                overflow-x: auto;
                                text-align: left;
                                font-family: monospace;
                            }
                        </style>
                    </head>
                    <body>
                    
                        <!-- Featured Post -->
                        <article class="post featured">
                            <header class="major">
                                <span class="date">February 26th, 2025</span>
                                <h2>LAB 3 - Time of Flight (ToF)</h2>
                            </header>
                    
                            <!-- Introduction -->
                            <section class="content-section">
                                <h3>Introduction:</h3>
                                <p>The aim of this lab was to integrate Time of Flight (ToF) sensors which will be crucial in the ultimate functionality of the car by accurately detecting the surrounding objects.</p>
                            </section>
                    
                            <!-- Virtual Environment Setup -->
                            <section class="content-section">
                                <h3>Prelab 3: </h3>
                                <p>The fundamental step of the prelab was to determine the wiring of the two ToF sensors, as well as how they would integrate with the IMU used in the previous lab. By reading through the datasheet, it was determined that the <code> blue connection indicated on the diagram below represents SDA, and the labeled yellow connection represents SCL.</code> The proposed sensors communicate through I2C, including the IMU from the previous lab, thus the QWIIC breakout board ought to be used establishing the connection among all sensors. The weires connecting from the QWIIC connector are further stripped and soldered onto the two ToF sensors.</p>
                                <code> insert the picture</code>
                                <p> Considering that the colour convention of the provided JST connector matched the colour convention of the LiPo battery connecting to the Artemis (that is, + terminal connecting to JST connector's red wire, and - terminal of the battery connecting to JST connector's black wire) the connector and the wires feeding into the LiPo battery connect as indicated in the diagram above. The connector from the LiPo battery was removed by separating the wires one at a time, and then cutting them individually. The connection between the LiPo battery and the wires was heat shrunk for a secure connection.</p>
                                <p>Afterwards, SParkFun VL53L1X 4m laser distance sensor library was installed for ToF sensor operation.</p>
                    

                            <!-- Image Centered -->
                            <section class="content-section">
                                <h3> </h3>
                                <h4></h4>
                                <h4>ToF Sensors' Position on the car</h4>
                                <p>My plan for this lab was to position the two ToF sensors at the front and on the side of the car, hence I connected them next to each other relative to the QWIIC connector, as opposed to on the opposite sides of the connector. This seemed like to most optimal choice in my opinion, considering that the car will be able to detect the obstacles in front and to its side. Fo detecting the obstacles on the other side of the car or behind the car, we ought to rotate the car. The two ToF sensor correspond to the longer QWIIC connector cables, due to the fact that they require higher positionality dependence as opposed to the IMU.</p>

                                <h3>Lab tasks</h3>
                                <h4>Testing the Time of Flight provided examples </h4>
                                <figure style="margin: 0; text-align: center;">
                                    <img src="images/IMG_0295.jpg" alt="Lab 1 Setup" width="400" style="display: block; margin: 0 auto;">
                                    <figcaption style="margin: 0; padding-top: 2px; padding-bottom: 20px;">ToF sensor testing setup</figcaption>
                                </figure>
                                <p>The <code>XSHUT</code> connection is not necessary for the initial ToF sensor testing. The first test was performed by using Example1_Wire_I2C under the Apollo3 library for scanning the I2C bus in order to verify the address of the sensor. The proposed output is as the following: </p>
                                <figure style="margin: 0; text-align: center;">
                                    <img src="images/i2c_output.png" alt="Lab 3" width="400" style="display: block; margin: 0 auto;">
                                    <figcaption style="margin: 0; padding-top: 2px; padding-bottom: 20px; padding-left: px;">Example1_Wire_I2C Serial Monitor Output</figcaption>
                                </figure>
                                <h4>Discussion on I2C address</h4>
                                <p>The indicated address is 0x29 which represents 0x52 bit shifted by 1, or <code>0x52 >> 1</code>, thus negecting the last bit. The very last bit is supposed to represent the direction, thus 0 for a write and 1 for a read, hence we are paying attention to the first 7 bits, as can be confirmed from the ToF datasheet.</code></p>
                                <figure style="margin: 0; text-align: center;">
                                    <img src="images/message_from_datasheet.png" alt="Lab 3" width="400" style="display: block; margin: 0 auto;">
                                    <figcaption style="margin: 0; padding-top: 2px; padding-bottom: 20px; padding-left: px;">Address description from the ToF datasheet</figcaption>
                                </figure>
                                <h4>Chosen mode discussion</h4>
                                <p>The mode that I chose was the Short Distance Mode, as according to the datasheet description, it has the sensor range of 1.3 meters and hence seems like a great fit for the proposed car. Furthermore, it has the best maximum distance under strong ambient light compared to other modes, adequate in this case.</p>
                                <figure style="margin: 0; text-align: center;">
                                    <img src="images/datasheet_2.png" alt="Lab 3" width="400" style="display: block; margin: 0 auto;">
                                    <figcaption style="margin: 0; padding-top: 2px; padding-bottom: 20px; padding-left: px;">Short distance mode description from the datasheet</figcaption>
                                </figure>
                                <h4>Testing the chosen mode: Distance Mode SHort</h4>
                                <p>The code for testing the proposed mode was adapted from SparkFun_VL53L1X_4m_Laser library's example named Example1_ReadDistance and incorporated in the <code>ble_arduino.ino file.</code> </p>
                                <figure style="margin: 0; text-align: center;">
                                    <img src="images/1tof_sensor_code_new.png" alt="Lab 3" width="400" style="display: block; margin: 0 auto;">
                                    <figcaption style="margin: 0; padding-top: 2px; padding-bottom: 20px; padding-left: 100px;">Firts ToF sensor reading</figcaption>
                                </figure>
                                <p>The setup for the sensor's distance detection looks like in the following images.</p>
                                <div style="display: flex; gap: 10px;">
                                    <img src="images/IMG_0279.jpg" alt="Image 1" style="width: 50%;">
                                    <img src="images/IMG_0281.jpg" alt="Image 2" style="width: 50%;">
                                    <figcaption style="margin: 0; padding-top: 2px; padding-bottom: 20px; padding-left: px;">The sensor distance measurement setup</figcaption>
                                </div>
                                  <p></p>

                                <p>What is more, the distanceSensor1 was instantiated. Afterwards, I implemented a case called <code>TIME_OF_FLIGHT</code> as can be seen below, which enabled sending data over to Python for easier visualization of the data obtained.</p>
                                <p></p>
                                <figure style="margin: 0; text-align: center;">
                                    <img src="images/case_TOF.png" alt="Lab 3" width="400" style="display: block; margin: 0 auto;">
                                    <figcaption style="margin: 0; padding-top: 2px; padding-bottom: 20px; padding-left: px;">Firts ToF sensor reading</figcaption>
                                </figure>
                                <p>On the Python side, the code receiving the data for easier plotting will be as in the following images. Note, the second screenshot below represents the calculation of mean and standard deviation for the distance of 15 cm specificially. The calcultions were performed for distances for 15 cm to 150 cm, in increments of 15 cm.</p>
                                <figure style="margin: 0; text-align: center;">
                                    <img src="images/python_code_for_tof.png" alt="Lab 3" width="400" style="display: block; margin: 0 auto;">
                                </figure>
                                <figure style="margin: 0; text-align: center;">
                                    <img src="images/python_code_for_tof2.png" alt="Lab 3" width="400" style="display: block; margin: 0 auto;">
                                    <figcaption style="margin: 0; padding-top: 2px; padding-bottom: 20px; padding-left: px;">ToF Python code</figcaption>
                                </figure>
                                <p>After obtaining data for the proposed distance increments, we ought to compute ToF sensor range, accuracy, repeatability, and ranging time. </p>
                                <h4>Sensor Range Discussion</h4>
                                <p>The proposed datasheet indicated that the short mode range of the ToF sensor is about 130 cm. In order to confirm the range myself, I tested the sensor behaviour at distances from 15 cm to 150 cm in increments of 15 cm. Hence, the graph below computed through the sent distance readings from Arduino displays the distance of ToF sensor to the wall. As shown in the "ToF Python code" figure, there were 10 means obtained for each distance measurements, and were plotted against the actual distances. The 130 cm line was indicated to display the proposed sensor range limit. There is a slight outlier at the 60 cm point mean measurement, which might be due to the sensor adapting to the new distance. The sensor range plot in the light and dark ambiance gives the same plot.</p>
                                <figure style="margin: 0; text-align: center;">
                                    <img src="images/sensor_range_plot.png" alt="Lab 3" width="400" style="display: block; margin: 0 auto;">
                                    <figcaption style="margin: 0; padding-top: 2px; padding-bottom: 20px; padding-left: px;">ToF Sensor Range Plot - Measured Distance vs Actual Distance</figcaption>
                                </figure>
                                <h4>Accuracy Discussion</h4>
                                <p>Similarly to the plot above, the accuracy plot is represented in the difference between the measured and the actual distances against the actual distances recorded from the ToF sensor to the wall. It can be observed that the accuracy is slightly worse as we increase the distance, which is to be expected considering the proposed sensor range in the datasheet. Once the 130 cm range line is passed, the accuracy of our ToF sensor visibly deteriorates.</p>
                                <figure style="margin: 0; text-align: center;">
                                    <img src="images/accuracy_plot.png" alt="Lab 3" width="400" style="display: block; margin: 0 auto;">
                                    <figcaption style="margin: 0; padding-top: 2px; padding-bottom: 20px; padding-left: px;">ToF Accuracy Plot - Difference in Measurement vs Actual Distance</figcaption>
                                </figure>
                                <h4>Repeatability Discussion</h4>
                                <p>Repeatability is computed by calculating the standard deviation by utilizing <code>statistics.stdev()</code> on our recorded distance data, and afterwards computing it against the actual distance. Standard deviation is below 0.3 cm until the 130 cm range line indicated in orange, after which it significantly increases and reaches almost 1 cm at the distance of 150 cm, which is as expected considering the proposed graphs for accuracy and sensor range.</p>
                                <figure style="margin: 0; text-align: center;">
                                    <img src="images/repeatability_plot.png" alt="Lab 3" width="400" style="display: block; margin: 0 auto;">
                                    <figcaption style="margin: 0; padding-top: 2px; padding-bottom: 20px; padding-left: px;">ToF Repeatability Plot - Standard Deviation vs Actual Distance</figcaption>
                                </figure>
                                <h4>Ranging Time</h4>
                                <p>As presented in the graph below, the ranging time of the samples taken at different distances was consistently under 35 ms with the aforementioned Arduino code. The loop time it takes to record the data samples ought to be optimized later in this lab report.</p>
                                <figure style="margin: 0; text-align: center;">
                                    <img src="images/rangingtime_plot.png" alt="Lab 3" width="400" style="display: block; margin: 0 auto;">
                                    <figcaption style="margin: 0; padding-top: 2px; padding-bottom: 20px; padding-left: px;">ToF Ranging Time Plot - Time vs Number of Samples</figcaption>
                                </figure>

                    
                              
                                  
                                  


                            
                                <!-- Embed YouTube Video -->
                                <iframe width="560" height="315" 
                                        src="https://youtube.com/embed/r6mWxkccSwo" 
                                        frameborder="0" allowfullscreen>
                                </iframe>
                            </section>

                        
                        <!-- </article> -->
                    
                    </body>
 
                    

                    

                    
                    

                    <!-- Posts -->


                    <!-- Footer -->
                </div>
                </div>
            <!-- Footer -->
            <footer id="footer">
                    <!-- <section>
                        <form method="post" action="#">
                            <div class="fields">
                                <div class="field">
                                    <label for="name">Name</label>
                                    <input type="text" name="name" id="name" />
                                </div>
                                <div class="field">
                                    <label for="email">Email</label>
                                    <input type="text" name="email" id="email" />
                                </div>
                                <div class="field">
                                    <label for="message">Message</label>
                                    <textarea name="message" id="message" rows="3"></textarea>
                                </div>
                            </div>
                            <ul class="actions">
                                <li><input type="submit" value="Send Message" /></li>
                            </ul>
                        </form>
                    </section>
                    <section class="split contact"> -->
                        <section>
                            <h3>EMAIL @ </h3>
                            <p><a href="#">kd374@cornell.edu</a></p>
                        </section>
                </footer> 

            <!-- Copyright -->
                <div id="copyright">
                    <ul><li>&copy; Untitled</li><li>Design: <a href="https://html5up.net">HTML5 UP</a></li></ul>
                </div>

        </div>

    <!-- Scripts -->
        <script src="assets/js/jquery.min.js"></script>
        <script src="assets/js/jquery.scrollex.min.js"></script>
        <script src="assets/js/jquery.scrolly.min.js"></script>
        <script src="assets/js/browser.min.js"></script>
        <script src="assets/js/breakpoints.min.js"></script>
        <script src="assets/js/util.js"></script>
        <script src="assets/js/main.js"></script>

</body>
</html>