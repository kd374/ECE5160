<!DOCTYPE html>
<html lang="en">
    <head>
		<title>ECE5160 Portfolio</title>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
		<link rel="stylesheet" href="assets/css/main.css" />
		<noscript><link rel="stylesheet" href="assets/css/noscript.css" /></noscript>
	</head>
<body class="is-preload">
		<!-- Wrapper -->
		<!--	<div id="wrapper" class="fade-in"> -->

				<!-- Intro -->
                <div id="intro">
                    <h1>LAB 10</h1>
                    <p>Grid Localization using Bayes Filter (Simulation)</p>
                    <ul class="actions">
                        <li><a href="#header" class="button icon solid solo fa-arrow-down scrolly">Continue</a></li>
                    </ul>
                </div>

            <!-- Header -->
            <header id="header">
                    <a href="index.html" class="logo">ECE 5160 | Fast Robots: Lab 10</a>
                </header>

                

            <!-- Nav -->
                <nav id="nav">
                    <ul class="links">
                        <li class="active"><a href="index.html">LAB 10</a></li>
                    </ul>
                    <ul class="icons">
                        <li><a href="https://www.linkedin.com/in/katarina-duric/" class="icon brands fa-linkedin"><span class="label">Linkedin</span></a></li> 
                        <li><a href="https://github.com/kd374" class="icon brands fa-github"><span class="label">GitHub</span></a></li>
                </nav>

				<!-- Main -->
                <div id="main">

                    <!-- Featured Post -->
                    <head>
                        <meta charset="UTF-8">
                        <meta name="viewport" content="width=device-width, initial-scale=1.0">
                        <title>LAB 10</title>
                    
                        <!-- Inline CSS for this page only -->
                        <style>
                            /* Reduce spacing between paragraphs, sections, and images */
                            p, h3, h2, pre, img {
                                margin-bottom: 10px; /* Less space between rows */
                            }
                    
                            /* Reduce spacing between sections */
                            .content-section {
                                margin-bottom: 15px; /* Less space between sections */
                                padding-bottom: 5px;
                                
                                border-bottom: 1px solid #ddd;  /* Adds a light gray line */
                                padding-bottom: 15px;
                                margin-bottom: 20px;

                            }
                    
                            /* Make subtitles (h3) left-aligned */
                            h3 {
                                text-align: left;
                                font-size: 20px; /* Adjust subtitle font size */
                                margin-left: 5px;
                            }
                    
                            /* Center images */
                            .center-content img {
                                display: block;
                                margin: 0 auto;
                                width: 500px; /* Adjust width */
                                height: auto;
                            }

                            .math-equation {
                                font-size: 18px;
                                display:inline-block;
                            }
                    
                            /* Center code blocks */
                            pre {
                                background-color: #f4f4f4;
                                padding: 10px;
                                border-radius: 5px;
                                overflow-x: auto;
                                text-align: left;
                                font-family: monospace;
                            }
                            details {
                                width: 100%;
                                padding: 10px;
                                border: 2px solid #ccc;
                                border-radius: 8px;
                                background-color: #f4f4f4;
                                margin: 10px 0;
                                font-family: 'monospace', Times, serif, sans-serif;
                                transition: all 0.3s ease;
                            }

                            details[open] {
                                background-color: #f4eae7; /* Different bg when expanded */
                                border-color: #ec96ad;
                            }

                            summary {
                                font-weight: bold;
                                cursor: pointer;
                                list-style: none;  /* removes default triangle */
                                position: relative;
                                padding-left: 20px;
                            }

                            /* Optional: Add a custom arrow */
                            summary::before {
                                content: 'â–¶';
                                position: absolute;
                                left: 0;
                                transition: transform 0.3s ease;
                            }

                            details[open] summary::before {
                                transform: rotate(90deg); /* Rotate arrow when open */
                            }

                            summary:focus {
                                outline: none;
                            }
                            table {
                            width: 60%;
                            border-collapse: collapse;
                            margin: 20px auto;
                            font-family: Arial, sans-serif;
                            }

                            th, td {
                            border: 1px solid #898181;
                            padding: 12px;
                            text-align: center;
                            vertical-align: middle;
                            }

                            th {
                            background-color: #f5f5f5;
                            font-weight: bold;
                            text-align: center !important;
                            }

                            tr:nth-child(even) {
                            background-color: #f9f9f9;
                            }

                            tr:hover {
                            background-color: #f1f1f1;
                            }
                        </style>
                          <!-- MathJax for LaTeX rendering -->
                        <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
                        <script id="MathJax-script" async
                        src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js">
                        </script>

                        
                    </head>
                    <body>

                    
                        <!-- Featured Post -->
                        <article class="post featured">
                            <header class="major">
                                <span class="date">April 23rd, 2025</span>
                                <h2>LAB 10 - Grid Localization using Bayes Filter (Simulation)</h2>
                            </header>
                    
                            <!-- Introduction -->
                            <section class="content-section">
                            <h3>Introduction</h3>
                            <p>The aim of this lab is to develop a Python simulation in order to localize a virtual robot in a two-dimensional space environment, which resembles the static room set up in the lab space for mapping (in Lab 9). The grid localization in this lab is performed in Python by implementing a Bayes Filter. The inputs of the Bayes Filter are the sensor measurements, control inputs, and a belief of robot's position within the map. The output for the Filter is the robot's position on the map. 
                            </section>
                            <section>
                            <h3>Localization</h3>
                            <p>Localization represents a process in which our robot uses the information about its surrounding based on probability in order to infer its position, due to the fact that it does not have the "true" knowledge of its position. In order to implement localization, we develop the Bayes Filter on our robot, which operates on a "belief" - which is influenced by sensor measurements and control inputs, allowing the robot to make a prediction of its position in space. With the sensor measurements and control inputs updating, the robot ought to update its belief as well due to the Bayesian interference. The state of the robot is represented in x and y coordinates, where x coordinates were defined same as in Lab 9, <code>-5.5 ft < x < 6.5 ft</code>, and y coordinates were defined same as in Lab 9, <code>-4.5 ft < y < 4.5 ft</code>. Furthermore, the orientation of the robot can be described as the following: <code>- 180 degrees < &theta; < 180 degrees</code>.</p>
                            <p>The 3D space around the robot is discretized into a grid of the volume of 12x9x9 cells, where each of the cells can be represented in 1x1 ft of planar space and 20 degrees of orientation.</p>
                            <h3>Bayes Filter Algorithm Implementation</h3>
                            <p>Bayes Filter is a probabilistic algorithm used for estimating state of a dynamic system given observations, by leveraging Bayesian inference, through which it constantly updates beliefs about the state based on updated sensor measurements and control inputs. The prediction step of the Filter increases the belief uncertainty, while the update step decreases the belief uncertainty. The algorithm was presented to us in class Lecture 20, and can be described by the following figure:</p>
                            <figure style="margin: 0; text-align: center;">
                                <img src="images/bayes_filter_algorithm.png" alt="Lab 8" width="500" style="display: block; margin: 0 auto;">Bayes Filter Algorithm</figcaption>
                            </figure>

                            <p>From the figure above, it can be inferred that <span class="math-equation">\(bel(x_{t-1})\)</span> represents the previous belief, which can be described as a 3D matrix, where each element further represents the probability that the robot is located in the compatible grid vell. Furthermore, <span class="math-equation">\(u_{t}\)</span> represents the current control input changing the pose from <span class="math-equation">\(x_{t-1}\)</span> to <span class="math-equation">\(x_{t}\)</span>, while <span class="math-equation">\(z_{t}\)</span> represents the current sensor rate of 18 readings with 20 degree increments. The algorithm performs through looping through the range of <span class="math-equation">\(x_{t}\)</span> values, described in the form of (<span class="math-equation">\(x, y, &theta;\)</span>) at each point in time. Hence, new belief with each iteration is determined, through multiplying the new state's probability with the previous state's probability, resulting into the sum of all multiplications represented in the prediction belief  <span class="math-equation">\( \overline{\mathrm{bel}}(x_t) \)</span>. The belief is thus updated by multiplying the probability of new sensor readings at the current pose and performing the normalization with &eta; after which  <span class="math-equation">\( {\mathrm{bel}}(x_t) \)</span> is obtained and returned.
  </p>                         
                            <p>The figure below represents the odometry model parameters, which can be used to describe the control inputs, as follows from Lecture 18 on Bayes Filter.. The odometry model represents the difference between two poses of the robot as initial rotation, translation, as well as final rotation.  </p>
                            <figure style="margin: 0; text-align: center;">
                                <img src="images/odometry_models.png" alt="Lab 8" width="500" style="display: block; margin: 0 auto;">Odometry Model Parameters</figcaption>
                            </figure>
                            <p></p>
                            </section>
                            <section>
                            <h4>Compute Control</h4>
                                <p>As aforementioned, the odometry model is computed through taking the difference between the previous and the current pose of the robot, and hence determining the initial rotation, translation, and final rotation, as in the formulas described in the <i>Odometry Model Parameters</i> figure above. This can be determined through NumPy's <code>arctan2()</code> function. The rotations are normalized to [-180, 180], and are calculated, as well as the translation.</p>
                                <pre><code>def compute_control(cur_pose, prev_pose):
    """ Given the current and previous odometry poses, this function extracts
    the control information based on the odometry motion model.

    Args:
        cur_pose  ([Pose]): Current Pose
        prev_pose ([Pose]): Previous Pose 

    Returns:
        [delta_rot_1]: Rotation 1  (degrees)
        [delta_trans]: Translation (meters)
        [delta_rot_2]: Rotation 2  (degrees)
    """
    y_comp = cur_pose[1] - prev_pose[1]
    x_comp = cur_pose[0] - prev_pose[0]
    theta_prev = prev_pose[2]
    theta_cur = cur_pose[2]
    delta_1 = np.degrees(math.atan2(y_comp, x_comp)) - theta_prev
    delta_rot_1 = mapper.normalize_angle(delta_1)
    delta_trans = math.sqrt(y_comp**2+x_comp**2)
    delta_rot_2 = mapper.normalize_angle(theta_cur - theta_prev - delta_1)

    return delta_rot_1, delta_trans, delta_rot_2  </code></pre>

    <h4>Odometry Motion Model</h4>
    <p>The odometry motion model is responsible for the probability that the motion calculated in the previous step was performed. This is performed by taking the previous pose and the current pose through <code>odom_motion_model()</code>, and extracting the odometry model parameters from them using <code>compute_control()</code>, calculating the probabilities of the parameters. Hence, the inputs consist of the current pose, previous pose, and odometry control values <code>(u)</code> for rotation_1, rotation_2, and translation. Knowing the current position as well as the previous position, the odometry control values (u), the return value is the probability <code>p(x'|x,u)</code>that the robot achieved the current position <code>x'</code>. The Gaussian distribution can be examined, while each of the events can be represented as independent. The probability of each of the events is thus multiplied in order to obtain the motion probability.</p>
    <pre><code>def odom_motion_model(cur_pose, prev_pose, u):
    """ Odometry Motion Model

    Args:
        cur_pose  ([Pose]): Current Pose
        prev_pose ([Pose]): Previous Pose
        (rot1, trans, rot2) (float, float, float): A tuple with control data in the format 
                                                    format (rot1, trans, rot2) with units (degrees, meters, degrees)


    Returns:
        prob [float]: Probability p(x'|x, u)
    """

    u_calc = compute_control(cur_pose, prev_pose)
    rot1_x = mapper.normalize_angle(u_calc[0])
    rot1_mu = mapper.normalize_angle(u[0])
    trans1_x = u_calc[1]
    trans1_mu = u[1]
    rot2_x = mapper.normalize_angle(u_calc[2])
    rot2_mu = mapper.normalize_angle(u[2])
    rot1_prob = loc.gaussian(mapper.normalize_angle(rot1_x-rot1_mu), 0, loc.odom_rot_sigma)
    trans_prob = loc.gaussian((trans1_x-trans1_mu), 0, loc.odom_trans_sigma)
    rot2_prob = loc.gaussian(mapper.normalize_angle(rot2_x - rot2_mu), 0, loc.odom_rot_sigma)

    prob = rot1_prob * trans_prob * rot2_prob

    return prob</code></pre>

    <h4>Prediction Step</h4>
    <p>The prediction step utilized 6 nested loops in order to calculate the probability of the robot moving onto the next grid cell. The inputs are the previous odometry position (prev_odom), as well as the current odometry position (cur_odom). The if statement speeds up the Filter, with the statement checking for the belief greater than 0.0001. If the belief is less than the value, then the code does not proceed with the remaining three for loops, due to the fact that the robot's position is not likely to be in those remaining grid cells. However, if the belief fulfills the greater or equal to condition, then the probability is calculated.</p>
    <pre><code>def prediction_step(cur_odom, prev_odom):
    """ Prediction step of the Bayes Filter.
    Update the probabilities in loc.bel_bar based on loc.bel from the previous time step and the odometry motion model.

    Args:
        cur_odom  ([Pose]): Current Pose
        prev_odom ([Pose]): Previous Pose
    """

    u = compute_control(cur_odom, prev_odom)
    for prev_x in range(mapper.MAX_CELLS_X):
        for prev_y in range(mapper.MAX_CELLS_X-3):
            for prev_a in range(mapper.MAX_CELLS_A):
                if loc.bel[prev_x,prev_y,prev_a] >= 0.0001:
                    for cur_x in range(mapper.MAX_CELLS_X):
                        for cur_y in range(mapper.MAX_CELLS_Y):
                            for cur_a in range(mapper.MAX_CELLS_A):
                                prev_pose = mapper.from_map(prev_x,prev_y,prev_a)
                                current_pose = mapper.from_map(cur_x,cur_y,cur_a)
                                prob = odom_motion_model(current_pose,prev_pose,u)
                                bel = loc.bel[prev_x-1,prev_y-1,prev_a-1]
                                loc.bel_bar[cur_x,cur_y,cur_a] += (prob*bel) </code></pre>
        <h4>Sensor model</h4>
        <p></p>



                            </section>
                                <h3>Discussion</h3>
                                <p>This lab was one of the most interesting labs in my opinion, it presents us with a new chapter into localization and planning, as well as incorporates the knowledge obtained in many previous labs, fundamentally Lab 6.</p>
    
                        

                    
                            </section>
                            <h4>Acknowledgements and References</h4>
                            <p>*I referenced Mikayla Lahr's website (2024) and Stephan Wagner's website (2024). Special thanks to TA Cheney for his help!</p>

                        
                        <!-- </article> -->
                    
                    </body>
 
                    

                    

                    
                    

                    <!-- Posts -->


                    <!-- Footer -->
                </div>
                </div>
            <!-- Footer -->
            <footer id="footer">
                    <!-- <section>
                        <form method="post" action="#">
                            <div class="fields">
                                <div class="field">
                                    <label for="name">Name</label>
                                    <input type="text" name="name" id="name" />
                                </div>
                                <div class="field">
                                    <label for="email">Email</label>
                                    <input type="text" name="email" id="email" />
                                </div>
                                <div class="field">
                                    <label for="message">Message</label>
                                    <textarea name="message" id="message" rows="3"></textarea>
                                </div>
                            </div>
                            <ul class="actions">
                                <li><input type="submit" value="Send Message" /></li>
                            </ul>
                        </form>
                    </section>
                    <section class="split contact"> -->
                        <section>
                            <h3>EMAIL @ </h3>
                            <p><a href="#">kd374@cornell.edu</a></p>
                        </section>
                </footer> 

            <!-- Copyright -->
                <div id="copyright">
                    <ul><li>&copy; Untitled</li><li>Design: <a href="https://html5up.net">HTML5 UP</a></li></ul>
                </div>

        </div>

    <!-- Scripts -->
        <script src="assets/js/jquery.min.js"></script>
        <script src="assets/js/jquery.scrollex.min.js"></script>
        <script src="assets/js/jquery.scrolly.min.js"></script>
        <script src="assets/js/browser.min.js"></script>
        <script src="assets/js/breakpoints.min.js"></script>
        <script src="assets/js/util.js"></script>
        <script src="assets/js/main.js"></script>

</body>
</html>
                    

                      
